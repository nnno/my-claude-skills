---
name: deep-research
description: >
  トピックについて深いリサーチを実行し、構造化されたMarkdownレポートを生成する。
  WebSearch/WebFetchで20〜50クエリを並列実行し、複数情報源のクロスチェックを行う。
  「リサーチして」「調査して」「deep research」「詳しく調べて」「技術調査」「比較調査」
  「〜について調べて」「市場調査」「トレンド調査」と依頼された時に使用する。
  Also triggers for "research this", "investigate", "deep dive into",
  "survey", "literature review", "technical investigation".
  単純な質問への回答、コードの実装、既知の事実の確認には使用しない。
---

# Deep Research

トピックについてWebSearch/WebFetchを活用した多角的リサーチを実行し、構造化されたMarkdownレポートを生成する。

## ワークフロー

### Phase 1: トピック受け取り

1. スキルの引数からリサーチトピックを取得する
2. 引数が空の場合、ユーザーにトピックを尋ねる
3. 出力ファイルパスを決定する:
   - 引数で `<topic> --output <path>` のように指定があればそのパスを使用
   - 未指定の場合、カレントディレクトリに `research-report-YYYY-MM-DD-<topic-slug>.md` を生成

### Phase 2: スコープ明確化

`AskUserQuestion` で以下を確認する:

**質問1: リサーチの深さ**
- 概要レベル（主要ポイントの把握、10〜15クエリ）
- 標準（バランスの取れた調査、20〜30クエリ）
- 詳細（網羅的な調査、40〜50クエリ）

**質問2: フォーカスと制約**
- 時間軸の制約（最新情報のみ / 過去N年 / 制限なし）
- 特に重視する観点や除外したい領域
- 特定の情報源の優先・排除

**質問3: 批判的レビュー**
- 有効にする（レポート生成後に批判的レビューフェーズを実行する）
- スキップする（Recommended）（レポート生成後すぐにサマリーを提示する）

ユーザーの回答に基づき、リサーチクエリのリストと担当分野の分割案を作成する。

### Phase 3: リサーチ実行

Taskツールで **sonnet** モデルの subagent を3〜5個並列起動し、テーマ別に検索を分担する。

各subagentの設定:
- `subagent_type: "general-purpose"`
- `model: "sonnet"`
- 担当する検索クエリ群とフォーカス領域を明示的にプロンプトに含める

各subagentへの指示内容:
- 割り当てられたクエリをWebSearchで実行する
- 有望な検索結果のURLをWebFetchで取得し、詳細を確認する
- 情報源ごとに以下を記録する:
  - URL
  - タイトル
  - 公開日（判明する場合）
  - 要点の箇条書き
  - 信頼性の評価（公式ドキュメント/企業ブログ/個人ブログ/フォーラム等）
- 矛盾する情報がある場合は両方記載し、どちらがより信頼できるか理由とともに報告する
- 最終的に、担当領域の調査結果をMarkdown形式で構造化して返す

GitHub MCP（`gh` コマンド）が利用可能な環境では、追加のsubagentを起動してリポジトリ・Issue・ディスカッションも調査する。利用不可の場合はスキップする。

すべてのsubagentの結果が返ってきたら、集約して矛盾・重複・カバレッジのギャップを確認する。

### Phase 4: レポート生成

Taskツールで **opus** モデルの subagent を起動する。

subagentの設定:
- `subagent_type: "general-purpose"`
- `model: "opus"`

subagentへの指示内容:
- Phase 3で収集した全調査結果をプロンプトに含める
- `references/report-template.md` のテンプレート構造に従いレポートを生成する
- 以下の原則を遵守する:
  - 一次情報・公式ドキュメントを優先して引用する
  - 事実と意見・推測を明確に区別する
  - 主張の根拠となるソースをインラインリンクまたはセクション末の参照リストで示す
  - 矛盾する情報がある場合は両方記載し、分析を加える
  - 情報の公開日を可能な限り明記する
- リンクは `<a href="URL" target="_blank">テキスト</a>` 形式で記述する
- 生成したレポートをWriteツールで出力ファイルパスに保存する

### Phase 5: 批判的レビュー（オプション）

Phase 2で批判的レビューが有効にされた場合のみ実行する。スキップが選択された場合はPhase 6に進む。

Taskツールで **sonnet** モデルの subagent を起動する。

subagentの設定:
- `subagent_type: "general-purpose"`
- `model: "sonnet"`

subagentへの指示内容:
- Phase 4で生成されたレポートの全文をプロンプトに含める
- 以下の観点でレポートを批判的にレビューする:
  - **根拠の妥当性**: 主張に対してソースが適切に引用されているか。引用元の信頼性は十分か
  - **論理の一貫性**: 論理的な飛躍や矛盾がないか。前提と結論が整合しているか
  - **カバレッジの偏り**: 特定の視点や立場に偏っていないか。反対意見や代替的な見解が欠落していないか
  - **情報の鮮度**: 古い情報に基づく主張が、現在も有効であるか
  - **過度の一般化**: 限定的なエビデンスから広範な結論を導いていないか
- レビュー結果を以下の形式で返す:
  - 指摘事項のリスト（重要度: 高/中/低）
  - 各指摘に対する修正提案
  - レポート全体の信頼性評価（A: 高い / B: 概ね信頼できる / C: 注意が必要）

レビュー結果に重要度「高」の指摘がある場合:
1. 指摘内容と修正提案をユーザーに提示する
2. 修正を反映するか確認する
3. ユーザーが修正を承認した場合、レポートに修正を反映する

レビュー結果はレポート末尾に「レビューノート」セクションとして追記する:
```markdown
---
## レビューノート

> このレポートは批判的レビューを経ています。信頼性評価: {A/B/C}

{重要度「中」以上の指摘事項と対応の要約}
```

### Phase 6: サマリー提示

1. 生成したレポートのファイルパスをユーザーに伝える
2. エグゼクティブサマリーの内容を提示する
3. カバレッジが不十分な領域や追加調査の候補があれば提案する
4. ユーザーが追加調査を希望する場合はPhase 3に戻る（批判的レビューが有効な場合、再度Phase 5も実行される）
